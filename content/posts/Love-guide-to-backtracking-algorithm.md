---
title: "Love guide to backtracking algorithm"
date: 2020-11-26T19:26:05+08:00
categories: ["Backtracking"]
tags: ["Backtracking"]
draft: false
---

@FeilyZhangå¾®ä¿¡æœªè¯»æ¶ˆæ¯ç´¯è®¡$594$æ¡ï¼Œé‚çªå‘å¥‡æƒ³æœªè¯»æ¶ˆæ¯åºåˆ—èƒ½å¦å‡‘æˆè‡ªç„¶æ•°$520$ï¼Œä»¥åŠèƒ½å¤Ÿå‡‘æˆå¤šå°‘ä¸ª$520$ï¼Œä»¥æ­¤tellå°å¯çˆ±ğŸ•ğŸ˜˜ğŸ–ã€‚äºæ˜¯ä¾¿æœ‰äº†è¿™ç¯‡æ–‡ç« ï¼Œå…¶æœ¬è´¨ä¸Šæ˜¯å­é›†æ±‚å’Œé—®é¢˜ã€‚æœ¬æ–‡é‡‡ç”¨å›æº¯ç®—æ³•çš„æ€æƒ³æœç´¢è§£ç©ºé—´ï¼Œé€šè¿‡å¤šç§å‰ªæç­–ç•¥å‡å°‘ä¸å¿…è¦çš„è§£ç©ºé—´æœç´¢ã€‚

### **é—®é¢˜å½¢å¼åŒ–**

è¯¥é—®é¢˜çš„è§£ç©ºé—´å¯å½¢å¼åŒ–ä¸º$n$å…ƒç»„$X = (X_1, X_2, \dots, X_n)$ï¼Œå…¶ä¸­$X_i = (x_1, x_2, \dots, x_m)$, $i = (1, 2, \dots, n)$, $x_j \in S$, $j = (1,2,\dots,m)$,$m \le |S|$ï¼Œ$S$ä¸ºæœ‰é™è‡ªç„¶æ•°é›†ã€‚ä»è€Œ$n$å…ƒç»„$X$ä¸­æ»¡è¶³å¦‚ä¸‹çº¦æŸæ¡ä»¶çš„å…ƒç´ æ„æˆè¯¥é—®é¢˜çš„ä¸€ä¸ªè§£

\begin{equation} \sum_{i = 1}^{m} x_i = t, t = 520\tag{1}\end{equation}

è®¾å½“å‰å·²æ»¡è¶³çº¦æŸæ¡ä»¶$(1)$å¼çš„éƒ¨åˆ†è§£ä¸ºå…ƒç»„$P = (X_1, X_2, \dots, X_i)$ï¼Œè‹¥å­˜åœ¨$n$å…ƒç»„$X$ä¸­çš„å…ƒç´ æ»¡è¶³$(1)$å¼ï¼Œåˆ™å°†å…¶æ·»åŠ è¿›å…ƒç»„$P$ä¸­æ„æˆè¯¥é—®é¢˜çš„å¦ä¸€ä¸ªè§£ï¼Œå³$P = (X_1, X_2, \dots, X_i, X_{i + 1})$ï¼Œå¦‚æ­¤åå¤è¿›è¡Œï¼Œç›´è‡³$n$å…ƒç»„$X$ä¸­ä¸å†å­˜åœ¨è¯¥é—®é¢˜çš„æœ‰æ•ˆè§£æˆ–è¯æ˜è¯¥é—®é¢˜æ— è§£ä¸ºæ­¢ã€‚

### **å‰ªæç­–ç•¥**

ç”±äºå­é›†é—®é¢˜è§£å‘é‡çš„ç»´æ•°$d$ä¸å›ºå®šï¼Œæç«¯æƒ…å†µä¸‹å­˜åœ¨æ»¡è¶³çº¦æŸæ¡ä»¶$(1)$å¼çš„$1$ç»´æˆ–$n$ç»´è§£å‘é‡ï¼ˆå…¶ä¸­$n$ä¸ºæœ‰é™è‡ªç„¶æ•°é›†$S$çš„å…ƒç´ ä¸ªæ•°ï¼‰ï¼Œä½†å¤šæ•°æƒ…å†µä¸‹è§£å‘é‡çš„ç»´æ•°$d$æ»¡è¶³$d \in (1, n)$ï¼Œå—æœ‰é™è‡ªç„¶æ•°é›†$S$å…ƒç´ çš„ä¸åŒæ•°é‡çš„ç»„åˆæ–¹å¼çš„å½±å“ï¼Œè¯¥é—®é¢˜çš„è§£ç©ºé—´å¼‚å¸¸åºå¤§ï¼Œä¸”è§£ç©ºé—´ä¸­è§£çš„æ•°ç›®éšæœ‰é™è‡ªç„¶æ•°é›†$S$å…ƒç´ ä¸ªæ•°çš„å¢åŠ å‘ˆæŒ‡æ•°çº§å¢é•¿ã€‚å› æ­¤è§£ç©ºé—´çš„æœç´¢å¿…é¡»è¾…ä¹‹ä»¥ä¸€å®šçš„å‰ªæç­–ç•¥ï¼Œç”¨ä»¥æå‡ç®—æ³•æ€§èƒ½ã€‚å…·ä½“çš„å‰ªæç­–ç•¥å¦‚ä¸‹

+ é¢„å‰ªæï¼šè¯¥ç®—æ³•æœ€å¤–å±‚çš„éå†æ–¹å‘ä¸ºåå‘éå†ï¼Œå³æ–¹å‘ä¸º$(length - 1) \to 0$ï¼Œä»è€Œé€šè¿‡å¯¹æ’åºåçš„åºåˆ—æ­£å‘ç´¯è®¡æ±‚å’Œä¸$t$ç›¸æ¯”è¾ƒæ¥ç¡®å®šåå‘éå†çš„ç»ˆæ­¢æ¡ä»¶ã€‚è‹¥æ­£å‘ç´¯è®¡å’Œå¤§äºç­‰äº$t$åˆ™è¿”å›ä¸Šä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ä½œä¸ºç»ˆæ­¢æ¡ä»¶ï¼›è‹¥æ­£å‘ç´¯è®¡æ±‚å’Œæœ€ç»ˆä»ç„¶å°äº$t$ï¼Œåˆ™è¿”å›$-1$ï¼Œç®—æ³•ç»ˆæ­¢ã€‚è¯¥å‰ªæç­–ç•¥ç®—æ³•å¦‚ä¸‹

```java
/**
 * This method realizes pre pruning.
 */
public boolean isPrePruning(int end) {
    return end == -1 ? true : false;
}

public int calEnd(int[] arr, int i, int t, int rst) {
    return i == -1 ? -1 : rst >= t ? i - 1 : calEnd(arr, i + 1, t, rst + arr[i]);
}
```

+ è¿è¡Œæ—¶å‰ªæï¼šåœ¨ç®—æ³•è¿è¡Œæ—¶ï¼Œé€šè¿‡åˆ¤æ–­å½“å‰åå‘æ¨è¿›çš„å…ƒç´ ç´¢å¼•ä¹‹åçš„æ‰€æœ‰å€¼çš„å’Œæ˜¯å¦å¤§äºç­‰äºåšå·®åçš„$t$ï¼Œæ¥å†³å®šæ˜¯å¦å‰ªæã€‚è‹¥å¤§äºç­‰äº$t$ï¼Œåˆ™ç»§ç»­æ¨è¿›å½“å‰è§£çš„æœç´¢ï¼›è‹¥å°äº$t$ï¼Œåˆ™ç®—æ³•å›æº¯æœç´¢ä¸‹ä¸€ä¸ªè§£ã€‚è¯¥å‰ªæç­–ç•¥ç®—æ³•å¦‚ä¸‹

```java
/**
 * This method implements runtime pruning.
 */
public boolean isRunPruning(int sum, int t) {
    return sum < t ? true : false;
}

public int calSum(int[] arr, int begin, int sum) {
    return begin == 0 ? sum + arr[begin] : calSum(arr, begin - 1, sum + arr[begin]);
}
```

### **è¿­ä»£æœç´¢ç®—æ³•**

å¯¹äºè§£ç©ºé—´$n$å…ƒç»„$X$ï¼Œæœ¬æ–‡é‡‡ç”¨å›æº¯ç®—æ³•çš„æ€æƒ³è¿›è¡Œè¿­ä»£æœç´¢ï¼Œå…¶ä¸­å›æº¯é€šè¿‡æ ˆæ¥å®ç°ã€‚ç®—æ³•å›¾ç¤ºå¦‚ä¸‹

![è¿­ä»£æœç´¢ç®—æ³•å›¾ç¤º](https://raw.githubusercontent.com/FeilyZhang/pic/master/images/article/egg.png)

1. æ­¥éª¤â‘ ä¸ºæœ€å¤–å±‚å¾ªç¯ï¼Œå…ˆåå‘å›ºå®šå…ƒç´ ï¼Œä»è€Œå½“å›ºå®šå…ƒç´ ç´¢å¼•æ»¡è¶³é¢„å‰ªææ¡ä»¶æ—¶ç®—æ³•ç»ˆæ­¢ï¼›
2. æ­¥éª¤â‘¡æ­£å‘å°†æˆªè‡³å½“å‰å›ºå®šå…ƒç´ ç´¢å¼•çš„æ‰€æœ‰ç´¢å¼•ä¾æ¬¡å…¥æ ˆï¼Œè¯¥æ ˆä½œä¸ºå›æº¯æ ˆï¼›
3. æ­¥éª¤â‘¢å›æº¯å…ƒç´ æŒ‰é¡ºåºä¾æ¬¡å‡ºæ ˆï¼Œé€šè¿‡åŸºäºå½“å‰å‡ºæ ˆå…ƒç´ ç´¢å¼•çš„åå‘è¿­ä»£æ¥åšå·®ï¼Œä»è€Œå®¹æ˜“é€šè¿‡åšå·®åç»“æœæ˜¯å¦ä¸º0æ¥åˆ¤æ–­èƒ½å¦æœç´¢åˆ°è§£ï¼Œå…¶ç»ˆæ­¢ç­–ç•¥å¦‚ä¸‹
   + è‹¥å½“å‰å›ºå®šå…ƒç´ åŠå‡ºæ ˆå…ƒç´ çº¦æŸä¸‹çš„å­ç©ºé—´æ— è§£ï¼Œåˆ™å½“å‰å›æº¯å…ƒç´ åå‘è¿­ä»£ç»ˆæ­¢ï¼Œç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªå›æº¯å…ƒç´ ï¼›
   + è‹¥æ‰¾åˆ°ä¸€ä¸ªæœ‰æ•ˆè§£ï¼Œåˆ™å½“å‰å›æº¯å…ƒç´ åå‘è¿­ä»£ç»ˆæ­¢ï¼Œç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªå›æº¯å…ƒç´ ï¼›
   + è‹¥æ»¡è¶³è¿è¡Œæ—¶å‰ªææ¡ä»¶ï¼Œåˆ™å½“å‰å›æº¯å…ƒç´ åå‘è¿­ä»£ç»ˆæ­¢ï¼Œç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªå›æº¯å…ƒç´ ï¼›
4. ç›´è‡³å›æº¯æ ˆä¸ºç©ºï¼Œç„¶ååå‘å›ºå®šå½“å‰å…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œç»§ç»­é‡å¤ä¸Šè¿°è¿‡ç¨‹ã€‚

ä¸Šè¿°ç®—æ³•è¿‡ç¨‹çš„ä»£ç å®ç°å¦‚ä¸‹

```java
import java.util.*;

public class SumOfSubsets {

    private int target;
    private Deque<Integer> os = new LinkedList<>();
    private Set<List<Integer>> rst = new HashSet<>();
    private List<Integer> temp = new LinkedList<>();

    public Set<List<Integer>> findAll(int[] arr, int t) {
        int end = calEnd(arr, 0, t, 0);
        if (isPrePruning(end)) return null;    // pre pruning.
        Arrays.sort(arr);
        for (int i = arr.length - 1, target = t; i >= end; i--) {
            if (arr[i] > target) continue;
            os = fillOS(i - 1, 0, os);
            while (!os.isEmpty()) {
                target -= arr[i];
                temp.add(arr[i]);
                for (int j = os.pop(); j > -1; j--) {
                    if (isRunPruning(calSum(arr, j, 0), target)) break;    // runtime pruning.
                    if (arr[j] > target) continue;
                    if (target == 0) break;
                    if (j == 0) os.clear();
                    target -= arr[j];
                    temp.add(arr[j]);
                }
                if (target == 0) rst.add(temp);
                temp = new LinkedList<>();
                target = t;
            }
        }
        return rst;
    }

    /**
     * This method is used to fill the backtrace stack.
     */
    public Deque<Integer> fillOS(int end, int i, Deque<Integer> offset) {
        if (i == end + 1) return offset;
        offset.push(i);
        return fillOS(end, i + 1, offset);
    }

    // The pruning algorithm is omitted here.

}
```

### **å½©è›‹Â·å›åˆ°ä¸»é¢˜**

$594$æ¡å¾®ä¿¡æ¶ˆæ¯åºåˆ—ä¸º[3, 3, 13, 1, 12, 3, 13, 5, 11, 4, 5, 2, 1, 1, 12, 14, 4, 6, 8, 12, 5, 3, 13, 3, 11, 8, 13, 1, 11, 6, 8, 2, 12, 5, 9, 3, 2, 14, 12, 4, 10, 3, 12, 1, 9, 8, 11, 10, 1, 11, 5, 9, 2, 6, 1, 3, 1, 11, 2, 8, 9, 8, 2, 8, 3, 10, 9, 2, 5, 12, 9, 11, 13, 2, 6, 11, 2, 5, 3, 4, 1, 8, 3, 6, 5, 1, 5, 1, 5, 1, 6, 1, 2, 4, 1, 1, 1, 1, 1, 1, 1, 2]ï¼Œå¯¹è¯¥æ¶ˆæ¯åºåˆ—åº”ç”¨ä¸Šè¿°ç®—æ³•ï¼Œå¹¶è¿›è¡Œä¸€å®šç¨‹åº¦çš„æ¶ˆæ¯å°è£…ï¼Œå¦‚ä¸‹

```java
public class I {

    private int target;
    private int[] set = new int[]{3, 3, 13, 1, 12, 3, 13, 5, 11, 4, 5, 2, 1, 1, 12, 14, 4, 6, 8, 12, 5, 3, 13, 3, 11, 8, 13, 1, 11, 6, 8, 2, 12, 5, 9, 3, 2, 14, 12, 4, 10, 3, 12, 1, 9, 8, 11, 10, 1, 11, 5, 9, 2, 6, 1, 3, 1, 11, 2, 8, 9, 8, 2, 8, 3, 10, 9, 2, 5, 12, 9, 11, 13, 2, 6, 11, 2, 5, 3, 4, 1, 8, 3, 6, 5, 1, 5, 1, 5, 1, 6, 1, 2, 4, 1, 1, 1, 1, 1, 1, 1, 2};
    private String who;
    private double from;
    private int to;

    public I say(int t) {
        target = t;
        return this;
    }

    public I to(String w) {
        who = w;
        return this;
    }

    public I from(double f) {
        from = f;
        return this;
    }

    public void to(int t) {
        int rst = new SumOfSubsets().findAll(set, target).size();
        System.out.println("If the full score of love for you is 10, then I must be. Is 10 ? " + (rst == 10));
    }

    public static void main(String[] args) {
        new I().say(520).to("@YuanLing").from(9.22).to(999);
    }

}
```

è¾“å‡ºä¸º

```
If the full score of love for you is 10, then I must be. Is 10 ? true
```

Do you know what I mean?